# TWM Configuration
# Tmux Workspace Manager for git worktree workflows

search_paths:
  - ~/Developer

exclude_path_components:
  - .archive
  - .bare
  - .cache
  - .cargo
  - .git
  - __pycache__
  - node_modules
  - target
  - venv
  - vendor
  - dist
  - build
  - .next

max_search_depth: 4
session_name_path_components: 2
follow_links: true

# Workspace definitions (order matters - first match wins)
# All definitions exclude directories containing .bare (worktree roots)
workspace_definitions:
  # Next.js TypeScript projects
  - name: nextjs-ts
    has_any_file:
      - next.config.js
      - next.config.ts
      - next.config.mjs
    has_all_files:
      - tsconfig.json
    missing_all_files:
      - .bare
    default_layout: nextjs

  # Vite TypeScript projects
  - name: vite-ts
    has_any_file:
      - vite.config.js
      - vite.config.ts
      - vite.config.mts
    has_all_files:
      - tsconfig.json
    missing_all_files:
      - .bare
    default_layout: vite

  # Rails projects
  - name: rails
    has_all_files:
      - Gemfile
      - config/routes.rb
    missing_all_files:
      - .bare
    default_layout: rails

  # Django projects
  - name: django
    has_all_files:
      - manage.py
    missing_all_files:
      - .bare
    default_layout: django

  # Default - any git repo or .twm.yaml
  - name: default
    has_any_file:
      - .git
      - .twm.yaml
    missing_all_files:
      - .bare
    default_layout: default

# Layout definitions
layouts:
  # Base layout with common windows
  - name: base
    commands:
      - twm-worktree-setup
      - tmux rename-window nvim
      - tmux send-keys 'nvim' C-m
      - tmux new-window -n claude
      - tmux send-keys 'claude' C-m
      - tmux new-window -n shell
      - tmux select-window -t 1

  # Next.js layout - nvim, claude, dev server (+ storybook if available)
  - name: nextjs
    commands:
      - twm-worktree-setup
      - tmux rename-window nvim
      - tmux send-keys 'nvim' C-m
      - tmux new-window -n claude
      - tmux send-keys 'claude' C-m
      - tmux new-window -n servers
      - tmux send-keys 'nr dev' C-m
      - tmux split-window -h
      - tmux send-keys 'grep -q "\"storybook\"" package.json && nr storybook --no-open || exit 0' C-m
      - tmux select-window -t 1

  # Vite layout - nvim, claude, dev server (+ storybook if available)
  - name: vite
    commands:
      - twm-worktree-setup
      - tmux rename-window nvim
      - tmux send-keys 'nvim' C-m
      - tmux new-window -n claude
      - tmux send-keys 'claude' C-m
      - tmux new-window -n servers
      - tmux send-keys 'nr dev' C-m
      - tmux split-window -h
      - tmux send-keys 'grep -q "\"storybook\"" package.json && nr storybook --no-open || exit 0' C-m
      - tmux select-window -t 1

  # Rails layout - nvim, claude, server
  - name: rails
    commands:
      - twm-worktree-setup
      - tmux rename-window nvim
      - tmux send-keys 'nvim' C-m
      - tmux new-window -n claude
      - tmux send-keys 'claude' C-m
      - tmux new-window -n server
      - tmux send-keys 'bin/dev' C-m
      - tmux select-window -t 1

  # Django layout - nvim, claude, server
  - name: django
    commands:
      - twm-worktree-setup
      - tmux rename-window nvim
      - tmux send-keys 'nvim' C-m
      - tmux new-window -n claude
      - tmux send-keys 'claude' C-m
      - tmux new-window -n server
      - tmux send-keys 'python manage.py runserver' C-m
      - tmux select-window -t 1

  # Default layout - nvim, claude, shell
  - name: default
    commands:
      - twm-worktree-setup
      - tmux rename-window nvim
      - tmux send-keys 'nvim' C-m
      - tmux new-window -n claude
      - tmux send-keys 'claude' C-m
      - tmux new-window -n shell
      - tmux select-window -t 1
